name: Flutter CI

on:
  pull_request:
    branches:
      - dev
  push:
    branches:
      - dev
      - qa

jobs:
  # test_ios:
  #   runs-on: macos-latest

  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v3

  #     - name: Set up Flutter
  #       uses: subosito/flutter-action@v2
  #       with:
  #         flutter-version: '3.22.3'

  #     - name: Install dependencies
  #       run: flutter pub get
  #       working-directory: news_app

  #     - name: Set up Xcode
  #       run: |
  #         sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
  #         sudo xcodebuild -runFirstLaunch
  #       working-directory: news_app

  #     - name: Set up iOS simulator
  #       uses: futureware-tech/simulator-action@v3
  #       with:
  #         model: 'iPhone 15 Pro'  # Assuming iPhone 15 Pro is the latest model
  #         version: '17.0'  # Assuming iOS 17.0 is the latest version

  #     - name: Build iOS
  #       run: flutter build ios --no-codesign
  #       working-directory: news_app

  #     - name: Run unit and widget tests
  #       run: flutter test
  #       working-directory: news_app

  #     - name: Run integration tests on iOS
  #       run: flutter drive --target=integration_test/app_test.dart -d "iPhone 15 Pro"
  #       working-directory: news_app

  test_android:
    runs-on: macos-latest
    strategy:
      matrix:
        api-level:
          - 34  # Change to a different available API level
      fail-fast: true

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Flutter SDK
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.22.3'

      - name: Install Flutter dependencies
        run: flutter pub get
        working-directory: news_app

      - name: Set up Android Emulator
        uses: reactivecircus/android-emulator-runner@v2
        with:
          api-level: ${{ matrix.api-level }}
          arch: x86_64
          profile: Pixel_8_API_35
          target: google_apis
          disable-animations: true
          script: flutter drive --driver=test_driver/integration_test.dart --target=integration_test/app_test.dart -d emulator-5554
